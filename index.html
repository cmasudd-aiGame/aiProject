<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo IA: Gemini vs Claude vs GPT</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { font-family: 'Courier New', monospace; background: #1a1a1a; color: #00ff00; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #board { width: 400px; border: 2px solid #333; }
        .panel { background: #222; padding: 20px; border-radius: 8px; width: 400px; margin-top: 15px; border: 1px solid #444; }
        .btn { background: #00ff00; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .log { height: 100px; overflow-y: scroll; background: #000; padding: 10px; font-size: 12px; margin-top: 10px; border: 1px solid #333; }
    </style>
</head>
<body>

    <h2>AI CHESS TOURNAMENT v1.0</h2>
    
    <div id="board"></div>

    <div class="panel">
        <div><strong>Estado:</strong> <span id="status">Listo para iniciar</span></div>
        <div><strong>Turno:</strong> <span id="turn">-</span></div>
        <div class="log" id="log">--- Registro de Movimientos ---</div>
        <button class="btn" onclick="startTournament()">INICIAR TORNEO</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        const game = new Chess();
        const board = Chessboard('board', 'start');

        const KEYS = {
            gemini: "AIzaSyBj8XIEnsy2scWOpuFA0f_i5B7QJDaEM50",
            openai: "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",
            claude: "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"
        };

        function logMove(msg) {
            const log = document.getElementById('log');
            log.innerHTML += `<div>> ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        async function getMoveFromAI(model, fen, history) {
            const prompt = `Juego de ajedrez profesional. FEN: ${fen}. Historial: ${history}. Responde solo con el movimiento en notación algebraica (ej: e4, Nf3).`;
            
            if (model === 'Gemini') {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${KEYS.gemini}`;
                const resp = await fetch(url, { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({contents: [{parts: [{text: prompt}]}]})});
                const data = await resp.json();
                return data.candidates[0].content.parts[0].text.trim();
            }
            
            if (model === 'GPT') {
                const resp = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {"Content-Type": "application/json", "Authorization": `Bearer ${KEYS.openai}`},
                    body: JSON.stringify({model: "gpt-4o", messages: [{role: "user", content: prompt}], temperature: 0})
                });
                const data = await resp.json();
                return data.choices[0].message.content.trim();
            }

            if (model === 'Claude') {
                const resp = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {"Content-Type": "application/json", "x-api-key": KEYS.claude, "anthropic-version": "2023-06-01"},
                    body: JSON.stringify({model: "claude-3-5-sonnet-20240620", max_tokens: 10, messages: [{role: "user", content: prompt}]})
                });
                const data = await resp.json();
                return data.content[0].text.trim();
            }
        }

        async function playTurn() {
            if (game.game_over()) {
                document.getElementById('status').innerText = "FIN DE PARTIDA";
                return;
            }

            const currentPlayer = game.turn() === 'w' ? 'Gemini' : 'Claude'; // Configurar según enfrentamiento
            document.getElementById('turn').innerText = currentPlayer;
            
            try {
                const move = await getMoveFromAI(currentPlayer, game.fen(), game.history().join(' '));
                const result = game.move(move);
                
                if (result) {
                    board.position(game.fen());
                    logMove(`${currentPlayer}: ${move}`);
                    setTimeout(playTurn, 1000);
                } else {
                    logMove(`ERROR: ${currentPlayer} intentó ${move} (Ilegal)`);
                }
            } catch (e) {
                logMove(`Error de conexión con ${currentPlayer}`);
                console.error(e);
            }
        }

        function startTournament() {
            logMove("Torneo Iniciado: Gemini vs Claude");
            playTurn();
        }
    </script>
</body>
</html>
